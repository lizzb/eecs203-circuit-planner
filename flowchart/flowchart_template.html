<svg 
  class="draggable-container"
  xmlns="http://www.w3.org/2000/svg"
  ng-mousedown="mouseDown($event)"
  ng-mousemove="mouseMove($event)"  
  >

  <defs>
<!-- spreadMethod defines how the gradient is spread out through the shape. 3 possible values: pad, repeat, and reflect. 'pad' means that the first/last color of the gradient is padded (spread out) before and after the gradient.-->
    <linearGradient 
      spreadMethod="pad" 
      y2="0" 
      x2="0" 
      y1="1" 
      x1="0" 
      id="nodeBackgroundGradient"
      >
      <stop 
        offset="0" 
        stop-opacity="0.99609" 
        stop-color="#56aaff"
        />
        <stop 
        offset="0.63934" 
        stop-opacity="0.99219" 
        stop-color="#d0d0e5"
        />
    </linearGradient>
  </defs>


  <g
    ng-repeat="node in chart.nodes"
    ng-mousedown="nodeMouseDown($event, node)"
    ng-attr-transform="translate({{node.x()}}, {{node.y()}})"
    >
    <rect 
      ng-attr-class="node-rect {{node.selected() && 'selected-node-rect' || (node == mouseOverNode && 'mouseover-node-rect' || 'node-rect')}}"
      ng-attr-ry="{{node.cornerRad()}}" ng-attr-rx="{{node.cornerRad()}}"
      x="0" y="0" 
      ng-attr-width="{{node.width()}}" 
      ng-attr-height="{{node.height()}}" 
      >
      <!--fill="url(#nodeBackgroundGradient)"-->
      

    </rect>

    <text
      class="node-label"
      ng-attr-x="{{node.width()/2}}"
      ng-attr-y="{{node.defaultLabelHeight()}}"
      >
      {{node.name()}}
    </text>

    <g
      ng-repeat="terminal in node.inputTerminals"
      ng-mousedown="terminalMouseDown($event, node, terminal, $index, true)"
      class="terminal input-terminal"
      >
      <text
        class="input-label"
        ng-attr-x="{{terminal.x() + node.defaultLabelOffset()}}" 
        ng-attr-y="{{terminal.y()}}"
        >
        <!-- + 20 -->
        {{terminal.name()}}
      </text>
      
      <circle
        class="terminal-circle"  
        ng-attr-class="{{terminal == mouseOverTerminal && 'mouseover-terminal-circle' || 'terminal-circle'}}"
        ng-attr-r="{{terminalSize}}" 
        ng-attr-cx="{{terminal.x()}}"
        ng-attr-cy="{{terminal.y()}}"
        />
    </g>

    <g
      ng-repeat="terminal in node.outputTerminals"
      ng-mousedown="terminalMouseDown($event, node, terminal, $index, false)"
      class="terminal output-terminal"
      >
      <text
        class="output-label"
        ng-attr-x="{{terminal.x() - node.defaultLabelOffset()}}" 
        ng-attr-y="{{terminal.y()}}"
        >
        <!-- - 20 -->
        {{terminal.name()}}
      </text>

      <circle
        class="terminal-circle"            
        ng-attr-class="{{terminal == mouseOverTerminal && 'mouseover-terminal-circle' || 'terminal-circle'}}"
        ng-attr-r="{{terminalSize}}" 
        ng-attr-cx="{{terminal.x()}}"
        ng-attr-cy="{{terminal.y()}}"
        />
    </g>
  </g>

  <g>
    <g
      ng-repeat="wire in chart.wires"
      class="wire"
      ng-mousedown="wireMouseDown($event, wire)"
      >
        <path
          ng-attr-class="{{wire.selected() && 'selected-wire-line' || (wire == mouseOverWire && 'mouseover-wire-line' || 'wire-line')}}"
          ng-attr-d="M {{wire.sourceCoordX()}}, {{wire.sourceCoordY()}}
                     C {{wire.sourceTangentX()}}, {{wire.sourceTangentY()}}
                       {{wire.destTangentX()}}, {{wire.destTangentY()}}
                       {{wire.destCoordX()}}, {{wire.destCoordY()}}"
          >
        </path>
        <circle
            ng-attr-class="{{wire.selected() && 'selected-wire-endpoint' || (wire == mouseOverWire && 'mouseover-wire-endpoint' || 'wire-endpoint')}}"
            r="5" 
            ng-attr-cx="{{wire.sourceCoordX()}}" 
            ng-attr-cy="{{wire.sourceCoordY()}}" 
            >
        </circle>

        <circle
            ng-attr-class="{{wire.selected() && 'selected-wire-endpoint' || (wire == mouseOverWire && 'mouseover-wire-endpoint' || 'wire-endpoint')}}"
            r="5" 
            ng-attr-cx="{{wire.destCoordX()}}" 
            ng-attr-cy="{{wire.destCoordY()}}" 
            >
        </circle>
    </g>
  </g>

  <g ng-if="draggingWire">
    <path
      class="dragging-wire dragging-wire-line"
      ng-attr-d="M {{dragPoint1.x}}, {{dragPoint1.y}}
                 C {{dragTangent1.x}}, {{dragTangent1.y}}
                   {{dragTangent2.x}}, {{dragTangent2.y}}
                   {{dragPoint2.x}}, {{dragPoint2.y}}"
      >
    </path>

    <circle
        class="dragging-wire dragging-wire-endpoint"
        ng-attr-r="{{dragPointR}}"
        ng-attr-cx="{{dragPoint1.x}}" 
        ng-attr-cy="{{dragPoint1.y}}" 
        >
    </circle>

    <circle
        class="dragging-wire dragging-wire-endpoint"
        ng-attr-r="{{dragPointR}}"
        ng-attr-cx="{{dragPoint2.x}}" 
        ng-attr-cy="{{dragPoint2.y}}" 
        >
    </circle>
  </g>

  <rect
      ng-if="dragSelecting"
      class="drag-selection-rect"
      ng-attr-x="{{dragSelectionRect.x}}"
      ng-attr-y="{{dragSelectionRect.y}}"
      ng-attr-width="{{dragSelectionRect.width}}"
      ng-attr-height="{{dragSelectionRect.height}}"
    >
  </rect>
  
</svg>
